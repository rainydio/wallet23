"lib.fif" include
"contract.fif" include <s constant code_slice

<b 1 8 u, b> constant req1
<b 2 8 u, b> constant req2

newkeypair nip 256 B>u@ constant key1
newkeypair nip 256 B>u@ constant key2
newkeypair nip 256 B>u@ constant key3

FN_SEQNO code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
100 <> abort"seqno failure"

FN_KEYS code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
2 pick 2 pick > abort"keys failure"
1 pick 1 pick > abort"keys failure"
drop drop drop

FN_LAST_REQUEST code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
null? not abort"last_request failure"

FN_LAST_REQUEST code_slice <b
	100 32 u,
	req1 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
hashu req1 hashu <> abort"last_request failure"

FN_LAST_REQUEST_KEY code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
null? not abort"last_request_key failure"

FN_LAST_REQUEST_KEY code_slice <b
	100 32 u,
	req1 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
key1 <> abort"last_request_key failure"

FN_PREV_REQUEST code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
null? not abort"prev_request failure"

FN_PREV_REQUEST code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
hashu req1 hashu <> abort"prev_request failure"

FN_PREV_REQUEST_KEY code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
null? not abort"prev_request_key failure"

FN_PREV_REQUEST_KEY code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
key3 <> abort"prev_request_key failure"

key1
FN_MY_REQUEST code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
null? not abort"my_request failure"

key3
FN_MY_REQUEST code_slice <b
	100 32 u,
	null nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	null nullref,
b> runvm drop 0 <> abort"error"
null? not abort"my_request failure"

key1
FN_MY_REQUEST code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
hashu req2 hashu <> abort"prev_request failure"

key2
FN_MY_REQUEST code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
null? not abort"my_request failure"

key3
FN_MY_REQUEST code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
hashu req1 hashu <> abort"my_request failure"

key1
FN_OTHER_REQUEST1 code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
hashu req1 hashu <> abort"other_request1 failure"

key2
FN_OTHER_REQUEST1 code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
hashu req1 hashu <> abort"other_request1 failure"

key3
FN_OTHER_REQUEST1 code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
hashu req2 hashu <> abort"other_request1 failure"

key1
FN_OTHER_REQUEST1_KEY code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
key3 <> abort"other_request1_key failure"

key2
FN_OTHER_REQUEST1_KEY code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
key3 <> abort"other_request1_key failure"

key3
FN_OTHER_REQUEST1_KEY code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
key1 <> abort"other_request1_key failure"

key1
FN_OTHER_REQUEST2 code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
null? not abort"other_request2 failure"

key2
FN_OTHER_REQUEST2 code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
hashu req2 hashu <> abort"other_request2 failure"

key3
FN_OTHER_REQUEST2 code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
null? not abort"other_request2 failure"

key1
FN_OTHER_REQUEST2_KEY code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
null? not abort"other_request2_key failure"

key2
FN_OTHER_REQUEST2_KEY code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
key1 <> abort"other_request2_key failure"

key3
FN_OTHER_REQUEST2_KEY code_slice <b
	100 32 u,
	req2 nullref,
	key1 256 u,
	key2 256 u,
	key3 256 u,
	req1 nullref,
b> runvm drop 0 <> abort"error"
null? not abort"other_request2_key failure"

depth 0 <> abort"stack depth"
